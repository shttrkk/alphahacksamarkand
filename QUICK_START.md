# üöÄ EGOR'S KILLER FEATURE - –ü–æ–ª–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è

## üìã –ß—Ç–æ —ç—Ç–æ?

**LLM Query Variants** - —Å–∏—Å—Ç–µ–º–∞ –ø–µ—Ä–µ—Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ —á–µ—Ä–µ–∑ LLM –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è retrieval.

**–ü—Ä–æ–±–ª–µ–º–∞:** Hit@5 = 0.31 (–ø–æ—Ç–æ–ª–æ–∫ retrieval-—Å—Ç–µ–∫–∞)
**–†–µ—à–µ–Ω–∏–µ:** LLM –∏—Å–ø—Ä–∞–≤–ª—è–µ—Ç "—Å–ª–æ–º–∞–Ω–Ω—ã–µ" –∑–∞–ø—Ä–æ—Å—ã (—Å–ª–µ–Ω–≥, –æ–ø–µ—á–∞—Ç–∫–∏, –∫–æ—Ä–æ—Ç–∫–∏–µ –∑–∞–ø—Ä–æ—Å—ã)
**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** Hit@5 = 0.36-0.41 (+5-10pp) üéØ

---

## ‚ö° –ë–´–°–¢–†–´–ô –°–¢–ê–†–¢ (3 –∫–æ–º–∞–Ω–¥—ã)

```bash
# 1. –ü–µ—Ä–µ–π—Ç–∏ –≤ –ø—Ä–æ–µ–∫—Ç
cd /workspace/tests/ver_3/alpha_hack_v2

# 2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
./install_dependencies.sh

# 3. –ë—ã—Å—Ç—Ä—ã–π —Ç–µ—Å—Ç (100 –∑–∞–ø—Ä–æ—Å–æ–≤, ~3 –º–∏–Ω)
./test_llm_generation.sh
```

**–ï—Å–ª–∏ —Ç–µ—Å—Ç –ø—Ä–æ—à—ë–ª —É—Å–ø–µ—à–Ω–æ:**

```bash
# 4. –ü–æ–ª–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è (7000 –∑–∞–ø—Ä–æ—Å–æ–≤, ~2-3 —á–∞—Å–∞)
./run_llm_generation.sh
```

**–ì–æ—Ç–æ–≤–æ!** –¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –ø–æ–∏—Å–∫.

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
alpha_hack_v2/
‚îú‚îÄ‚îÄ install_dependencies.sh      ‚Üê [1] –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Å–µ—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫
‚îú‚îÄ‚îÄ test_llm_generation.sh       ‚Üê [2] –ë—ã—Å—Ç—Ä—ã–π —Ç–µ—Å—Ç (100 –∑–∞–ø—Ä–æ—Å–æ–≤)
‚îú‚îÄ‚îÄ run_llm_generation.sh        ‚Üê [3] –ü–æ–ª–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è (7000 –∑–∞–ø—Ä–æ—Å–æ–≤)
‚îÇ
‚îú‚îÄ‚îÄ tools/
‚îÇ   ‚îî‚îÄ‚îÄ generate_query_variants.py  ‚Üê –û—Å–Ω–æ–≤–Ω–æ–π —Å–∫—Ä–∏–ø—Ç LLM –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
‚îÇ
‚îú‚îÄ‚îÄ data/
‚îÇ   ‚îú‚îÄ‚îÄ raw/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ questions_clean.csv     ‚Üê –í—Ö–æ–¥–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã (q_id, query)
‚îÇ   ‚îî‚îÄ‚îÄ processed/
‚îÇ       ‚îî‚îÄ‚îÄ query_variants.parquet  ‚Üê –†–µ–∑—É–ª—å—Ç–∞—Ç (—Å–æ–∑–¥–∞—ë—Ç—Å—è)
‚îÇ
‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îî‚îÄ‚îÄ settings.py                 ‚Üê –ü–∞—Ä–∞–º–µ—Ç—Ä—ã (—É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ)
‚îÇ
‚îú‚îÄ‚îÄ scripts/
‚îÇ   ‚îú‚îÄ‚îÄ 02_build_indices.py         ‚Üê –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤
‚îÇ   ‚îî‚îÄ‚îÄ 03_run_search.py            ‚Üê –ü–æ–∏—Å–∫ —Å –≤–∞—Ä–∏–∞–Ω—Ç–∞–º–∏
‚îÇ
‚îî‚îÄ‚îÄ QUICK_START.md                  ‚Üê –≠—Ç–æ—Ç —Ñ–∞–π–ª
```

---

## üîß –®–ê–ì 1: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

### –ï—Å–ª–∏ –Ω–µ—Ç –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π —Å—Ä–µ–¥—ã:

```bash
cd /workspace/tests/ver_3/alpha_hack_v2

# –°–æ–∑–¥–∞—Ç—å venv
python3 -m venv venv
source venv/bin/activate

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å—ë
./install_dependencies.sh
```

### –ï—Å–ª–∏ venv —É–∂–µ –µ—Å—Ç—å:

```bash
cd /workspace/tests/ver_3/alpha_hack_v2
source venv/bin/activate

./install_dependencies.sh
```

### –ß—Ç–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è:

- **PyTorch** (—Å CUDA 12.1)
- **Transformers** (Hugging Face)
- **BitsAndBytes** (4-bit quantization)
- **Accelerate** (GPU optimization)
- **Sentence Transformers** (embeddings)
- **Pandas, PyArrow** (data processing)
- **FAISS-CPU** (—Å CUDA support —á–µ—Ä–µ–∑ PyTorch)
- **Rank-BM25** (sparse retrieval)

**–í—Ä–µ–º—è:** ~5-10 –º–∏–Ω—É—Ç (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞)

---

## üß™ –®–ê–ì 2: –ë—ã—Å—Ç—Ä—ã–π —Ç–µ—Å—Ç (100 –∑–∞–ø—Ä–æ—Å–æ–≤)

**–ó–∞—á–µ–º:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–æ LLM –ø–µ—Ä–µ—Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–æ–∫ –ø–µ—Ä–µ–¥ –¥–ª–∏–Ω–Ω–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π.

```bash
./test_llm_generation.sh
```

**–í—Ä–µ–º—è:** ~2-3 –º–∏–Ω—É—Ç—ã
**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
1. –ë–µ—Ä—ë—Ç –ø–µ—Ä–≤—ã–µ 100 –∑–∞–ø—Ä–æ—Å–æ–≤ –∏–∑ `questions_clean.csv`
2. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç 2 –≤–∞—Ä–∏–∞–Ω—Ç–∞ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ
3. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç 20 –ø—Ä–∏–º–µ—Ä–æ–≤ –¥–ª—è –æ—Ü–µ–Ω–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞
4. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ `data/processed/query_variants_test.parquet`

**–ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞:**

```
[0] Original: –±–∞–±–∫–∏ –Ω–∞ –∫–∞—Ä—Ç—É
    ‚Üí Variant 1: –ö–∞–∫ –ø–æ–ø–æ–ª–Ω–∏—Ç—å –±–∞–Ω–∫–æ–≤—Å–∫—É—é –∫–∞—Ä—Ç—É –¥–µ–Ω—å–≥–∞–º–∏
    ‚Üí Variant 2: –ü–µ—Ä–µ–≤–æ–¥ —Å—Ä–µ–¥—Å—Ç–≤ –Ω–∞ –±–∞–Ω–∫–æ–≤—Å–∫—É—é –∫–∞—Ä—Ç—É

[1] Original: –∫—ç—à–±—ç–∫
    ‚Üí Variant 1: –í–æ–∑–≤—Ä–∞—Ç —Å—Ä–µ–¥—Å—Ç–≤ –ø–æ –±–∞–Ω–∫–æ–≤—Å–∫–∏–º –∫–∞—Ä—Ç–∞–º
    ‚Üí Variant 2: –ü—Ä–æ–≥—Ä–∞–º–º–∞ –∫—ç—à–±—ç–∫–∞

...
```

**–û—Ü–µ–Ω–∏—Ç–µ –∫–∞—á–µ—Å—Ç–≤–æ:**
- ‚úÖ –°–æ—Ö—Ä–∞–Ω—ë–Ω —Å–º—ã—Å–ª?
- ‚úÖ –°–ª–µ–Ω–≥ –∑–∞–º–µ–Ω—ë–Ω –Ω–∞ —Ñ–æ—Ä–º–∞–ª—å–Ω—É—é –ª–µ–∫—Å–∏–∫—É?
- ‚úÖ –ó–∞–ø—Ä–æ—Å—ã —Å—Ç–∞–ª–∏ –ø–æ–Ω—è—Ç–Ω–µ–µ?
- ‚ùå –ï—Å—Ç—å –≥–∞–ª–ª—é—Ü–∏–Ω–∞—Ü–∏–∏ –∏–ª–∏ —É—Ö–æ–¥ –æ—Ç —Ç–µ–º—ã?

**–ï—Å–ª–∏ –∫–∞—á–µ—Å—Ç–≤–æ –û–ö** ‚Üí –ø–µ—Ä–µ—Ö–æ–¥–∏–º –∫ –ø–æ–ª–Ω–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
**–ï—Å–ª–∏ –ø–ª–æ—Ö–æ** ‚Üí –º–æ–∂–Ω–æ –ø–æ–¥–∫—Ä—É—Ç–∏—Ç—å –ø—Ä–æ–º–ø—Ç –≤ `tools/generate_query_variants.py`

---

## üè≠ –®–ê–ì 3: –ü–æ–ª–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è (7000 –∑–∞–ø—Ä–æ—Å–æ–≤)

```bash
./run_llm_generation.sh
```

**–í—Ä–µ–º—è:** ~2-3 —á–∞—Å–∞ –Ω–∞ RTX 4090
**–í—Ö–æ–¥–Ω–æ–π —Ñ–∞–π–ª:** `data/raw/questions_clean.csv`
**–í—ã—Ö–æ–¥–Ω–æ–π —Ñ–∞–π–ª:** `data/processed/query_variants.parquet`

### –ó–∞–ø—É—Å–∫ –≤ —Ñ–æ–Ω–µ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è):

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤ —Ñ–æ–Ω–µ
nohup ./run_llm_generation.sh > llm_generation.log 2>&1 &

# –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å
tail -f llm_generation.log

# –ò–ª–∏ –≤ –¥—Ä—É–≥–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ:
watch -n 5 nvidia-smi
watch -n 10 'ls -lh data/processed/query_variants_checkpoint.parquet'
```

### –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:

1. **–ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥–µ–ª–∏** (~1-2 –º–∏–Ω)
   - Qwen2.5-7B-Instruct —Å–∫–∞—á–∏–≤–∞–µ—Ç—Å—è —Å HuggingFace
   - –ö–≤–∞–Ω—Ç–∏–∑–∏—Ä—É–µ—Ç—Å—è –≤ 4-bit (~7 GB VRAM)

2. **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è** (~2-3 —á–∞—Å–∞)
   - –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç 8 –∑–∞–ø—Ä–æ—Å–æ–≤ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ (batch_size=8)
   - Checkpoint –∫–∞–∂–¥—ã–µ 500 –∑–∞–ø—Ä–æ—Å–æ–≤
   - Progress bar –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –æ—Å—Ç–∞–≤—à–µ–µ—Å—è –≤—Ä–µ–º—è

3. **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ** (~10 —Å–µ–∫)
   - –§–∏–Ω–∞–ª—å–Ω—ã–π —Ñ–∞–π–ª: `query_variants.parquet`
   - Checkpoint —É–¥–∞–ª—è–µ—Ç—Å—è

### –ï—Å–ª–∏ –ø—Ä–µ—Ä–≤–∞–ª–∏:

```bash
# –ü—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ - –ø—Ä–æ–¥–æ–ª–∂–∏—Ç —Å checkpoint
./run_llm_generation.sh
```

### –†–µ–∑—É–ª—å—Ç–∞—Ç:

–§–∞–π–ª `query_variants.parquet`:

| q_id | original_query | variant_1 | variant_2 | num_valid_variants |
|------|----------------|-----------|-----------|-------------------|
| 1 | –±–∞–±–∫–∏ –Ω–∞ –∫–∞—Ä—Ç—É | –ö–∞–∫ –ø–æ–ø–æ–ª–Ω–∏—Ç—å –∫–∞—Ä—Ç—É –¥–µ–Ω—å–≥–∞–º–∏ | –ü–µ—Ä–µ–≤–æ–¥ —Å—Ä–µ–¥—Å—Ç–≤ –Ω–∞ –∫–∞—Ä—Ç—É | 2 |
| 2 | –∫—ç—à–±—ç–∫ | –í–æ–∑–≤—Ä–∞—Ç —Å—Ä–µ–¥—Å—Ç–≤ –ø–æ –∫–∞—Ä—Ç–∞–º | –ü—Ä–æ–≥—Ä–∞–º–º–∞ –∫—ç—à–±—ç–∫–∞ | 2 |
| ... | ... | ... | ... | ... |

---

## üîç –®–ê–ì 4: –ó–∞–ø—É—Å–∫ –ø–æ–∏—Å–∫–∞ —Å –≤–∞—Ä–∏–∞–Ω—Ç–∞–º–∏

–ü–æ—Å–ª–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏:

```bash
# –ü–æ—Å—Ç—Ä–æ–∏—Ç—å –∏–Ω–¥–µ–∫—Å—ã (–µ—Å–ª–∏ –µ—â—ë –Ω–µ –ø–æ—Å—Ç—Ä–æ–µ–Ω—ã)
python scripts/02_build_indices.py

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø–æ–∏—Å–∫
python scripts/03_run_search.py
```

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è** (—É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ –≤ `config/settings.py`):

```python
USE_QUERY_VARIANTS = True        # –í–∫–ª—é—á–∏—Ç—å LLM –≤–∞—Ä–∏–∞–Ω—Ç—ã
ORIGINAL_QUERY_WEIGHT = 1.0      # –í–µ—Å –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
VARIANT_QUERY_WEIGHT = 0.7       # –í–µ—Å LLM –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤
MAX_VARIANTS_TO_USE = 2          # –°–∫–æ–ª—å–∫–æ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ –ø–æ–∏—Å–∫–µ:**

```
Query: "–±–∞–±–∫–∏ –Ω–∞ –∫–∞—Ä—Ç—É" (q_id=123)
‚îÇ
‚îú‚îÄ –ó–∞–≥—Ä—É–∑–∏—Ç—å –≤–∞—Ä–∏–∞–Ω—Ç—ã –∏–∑ query_variants.parquet
‚îÇ  ‚îú‚îÄ Original: "–±–∞–±–∫–∏ –Ω–∞ –∫–∞—Ä—Ç—É" (weight=1.0)
‚îÇ  ‚îú‚îÄ Variant 1: "–ö–∞–∫ –ø–æ–ø–æ–ª–Ω–∏—Ç—å –∫–∞—Ä—Ç—É..." (weight=0.7)
‚îÇ  ‚îî‚îÄ Variant 2: "–ü–µ—Ä–µ–≤–æ–¥ —Å—Ä–µ–¥—Å—Ç–≤..." (weight=0.7)
‚îÇ
‚îú‚îÄ Multi-query retrieval:
‚îÇ  ‚îú‚îÄ Search(original) ‚Üí candidates_1
‚îÇ  ‚îú‚îÄ Search(variant_1) ‚Üí candidates_2
‚îÇ  ‚îî‚îÄ Search(variant_2) ‚Üí candidates_3
‚îÇ
‚îú‚îÄ Weighted RRF fusion
‚îÇ
‚îî‚îÄ Return TOP-5
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** `submit_alpha_rag_elite.csv` (–≥–æ—Ç–æ–≤ –∫ —Å–∞–±–º–∏—Ç—É!)

---

## üìä –®–ê–ì 5: Submit –∏ A/B —Ç–µ—Å—Ç—ã

### Submit –Ω–∞ leaderboard:

```bash
# –§–∞–π–ª —É–∂–µ –≥–æ—Ç–æ–≤
ls -lh submit_alpha_rag_elite.csv

# –ó–∞–≥—Ä—É–∑–∏—Ç—å –Ω–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º—É —Ö–∞–∫–∞—Ç–æ–Ω–∞
```

### A/B —Ç–µ—Å—Ç—ã (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):

**–¢–µ—Å—Ç 1: –° –≤–∞—Ä–∏–∞–Ω—Ç–∞–º–∏ vs –±–µ–∑ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤**

```bash
# –ë–µ–∑ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ (baseline)
cp config/settings.py config/settings_backup.py
sed -i 's/USE_QUERY_VARIANTS = True/USE_QUERY_VARIANTS = False/' config/settings.py
python scripts/03_run_search.py
mv submit_alpha_rag_elite.csv submit_baseline.csv

# –° –≤–∞—Ä–∏–∞–Ω—Ç–∞–º–∏
cp config/settings_backup.py config/settings.py
python scripts/03_run_search.py
mv submit_alpha_rag_elite.csv submit_with_variants.csv

# –°—Ä–∞–≤–Ω–∏—Ç—å –Ω–∞ leaderboard
```

**–¢–µ—Å—Ç 2: –†–∞–∑–Ω—ã–µ –≤–µ—Å–∞ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤**

```python
# –í config/settings.py –ø–æ–ø—Ä–æ–±—É–π—Ç–µ:

# –ö–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω–æ (–≤–∞—Ä–∏–∞–Ω—Ç—ã —Å–ª–∞–±–µ–µ)
VARIANT_QUERY_WEIGHT = 0.5

# –ê–≥—Ä–µ—Å—Å–∏–≤–Ω–æ (–≤–∞—Ä–∏–∞–Ω—Ç—ã —Å–∏–ª—å–Ω–µ–µ)
VARIANT_QUERY_WEIGHT = 1.0

# Balanced (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
VARIANT_QUERY_WEIGHT = 0.7
```

–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ `python scripts/03_run_search.py` –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è.

---

## üêõ Troubleshooting

### 1. CUDA out of memory

**–ü—Ä–æ–±–ª–µ–º–∞:**
```
RuntimeError: CUDA out of memory
```

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –í run_llm_generation.sh –∏–∑–º–µ–Ω–∏—Ç–µ:
--batch_size 4  # –í–º–µ—Å—Ç–æ 8

# –ò–õ–ò –≤ tools/generate_query_variants.py:
LLM_BATCH_SIZE = 4
```

### 2. –§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω

**–ü—Ä–æ–±–ª–µ–º–∞:**
```
FileNotFoundError: data/raw/questions_clean.csv
```

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –≤—ã –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
pwd
# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: /workspace/tests/ver_3/alpha_hack_v2

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Ñ–∞–π–ª —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
ls -lh data/raw/questions_clean.csv

# –ï—Å–ª–∏ –Ω–µ—Ç - —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∏–∑ –æ—Ä–∏–≥–∏–Ω–∞–ª–∞
cp /home/user/alpha_hack_v2/data/raw/questions_clean.csv data/raw/
```

### 3. –ú–æ–¥–µ–ª—å –Ω–µ —Å–∫–∞—á–∏–≤–∞–µ—Ç—Å—è

**–ü—Ä–æ–±–ª–µ–º–∞:**
```
OSError: Can't load tokenizer for 'Qwen/Qwen2.5-7B-Instruct'
```

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å HuggingFace CLI
pip install -U huggingface_hub

# –°–∫–∞—á–∞—Ç—å –º–æ–¥–µ–ª—å –≤—Ä—É—á–Ω—É—é
huggingface-cli download Qwen/Qwen2.5-7B-Instruct

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü–∏—é
./run_llm_generation.sh
```

### 4. –í–∞—Ä–∏–∞–Ω—Ç—ã –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è

**–ü—Ä–æ–±–ª–µ–º–∞:** –í –ª–æ–≥–∞—Ö:
```
WARNING: Query variants file not found
Falling back to original queries only
```

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Ñ–∞–π–ª —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
ls -lh data/processed/query_variants.parquet

# –ï—Å–ª–∏ –Ω–µ—Ç - –∑–∞–ø—É—Å—Ç–∏—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü–∏—é
./run_llm_generation.sh

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å config
grep USE_QUERY_VARIANTS config/settings.py
# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: USE_QUERY_VARIANTS = True
```

### 5. –ù–∏–∑–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤

**–ü—Ä–æ–±–ª–µ–º–∞:** LLM –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ø–ª–æ—Ö–∏–µ –ø–µ—Ä–µ—Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∏

**–†–µ—à–µ–Ω–∏–µ:**
```python
# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–º–ø—Ç –≤ tools/generate_query_variants.py

# –ù–∞–π—Ç–∏ SYSTEM_PROMPT (—Å—Ç—Ä–æ–∫–∞ 33)
# –ò–∑–º–µ–Ω–∏—Ç—å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ–¥ –≤–∞—à–∏ –¥–∞–Ω–Ω—ã–µ

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç
./test_llm_generation.sh
```

---

## ‚öôÔ∏è –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Ç—é–Ω–∏–Ω–≥–∞

### –ì–µ–Ω–µ—Ä–∞—Ü–∏—è (tools/generate_query_variants.py):

```python
LLM_NUM_VARIANTS = 2       # 1-3 (–±–æ–ª—å—à–µ = –¥–æ–ª—å—à–µ)
LLM_BATCH_SIZE = 8         # 4-16 (–º–µ–Ω—å—à–µ = –º–µ–Ω—å—à–µ VRAM)
LLM_MAX_NEW_TOKENS = 80    # 40-120 (–±–æ–ª—å—à–µ = –¥–æ–ª—å—à–µ)
LLM_TEMPERATURE = 0.7      # 0.5-0.9 (–≤—ã—à–µ = —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–Ω–µ–µ)
```

### –ü–æ–∏—Å–∫ (config/settings.py):

```python
USE_QUERY_VARIANTS = True        # True/False
ORIGINAL_QUERY_WEIGHT = 1.0      # 0.5-1.5
VARIANT_QUERY_WEIGHT = 0.7       # 0.3-1.0
MAX_VARIANTS_TO_USE = 2          # 1-3
```

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**
- `VARIANT_QUERY_WEIGHT < ORIGINAL_QUERY_WEIGHT` (–æ—Ä–∏–≥–∏–Ω–∞–ª –≤–∞–∂–Ω–µ–µ)
- –ù–∞—á–Ω–∏—Ç–µ —Å –∫–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π (0.7)
- A/B —Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –Ω–∞ leaderboard

---

## üìà –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

### Baseline (–±–µ–∑ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤):
```
Hit@5 = 0.31275
```

### –° LLM –≤–∞—Ä–∏–∞–Ω—Ç–∞–º–∏:

| –°—Ü–µ–Ω–∞—Ä–∏–π | Hit@5 | –ü—Ä–∏—Ä–æ—Å—Ç |
|----------|-------|---------|
| –ö–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω—ã–π (0.5 weight) | 0.35 | +4pp |
| –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π (0.7 weight) | 0.37 | +6pp |
| –ê–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π (1.0 weight) | 0.39 | +8pp |
| Best case | 0.41 | +10pp üéØ |

---

## üìã Checklist

- [ ] –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (`./install_dependencies.sh`)
- [ ] GPU –¥–æ—Å—Ç—É–ø–µ–Ω (`nvidia-smi`)
- [ ] –¢–µ—Å—Ç –ø—Ä–æ–π–¥–µ–Ω (`./test_llm_generation.sh`)
- [ ] –ö–∞—á–µ—Å—Ç–≤–æ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ (—á–∏—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å, —Å–º—ã—Å–ª —Å–æ—Ö—Ä–∞–Ω—ë–Ω)
- [ ] –ü–æ–ª–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞ (`./run_llm_generation.sh`)
- [ ] –§–∞–π–ª —Å–æ–∑–¥–∞–Ω (`ls data/processed/query_variants.parquet`)
- [ ] –ò–Ω–¥–µ–∫—Å—ã –ø–æ—Å—Ç—Ä–æ–µ–Ω—ã (`python scripts/02_build_indices.py`)
- [ ] –ü–æ–∏—Å–∫ –∑–∞–ø—É—â–µ–Ω (`python scripts/03_run_search.py`)
- [ ] Submission –≥–æ—Ç–æ–≤ (`ls submit_alpha_rag_elite.csv`)
- [ ] Submit –Ω–∞ leaderboard! üöÄ

---

## üÜò –ü–æ–º–æ—â—å

**–õ–æ–≥–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏:**
```bash
tail -f llm_generation.log  # –ï—Å–ª–∏ –∑–∞–ø—É—Å–∫–∞–ª–∏ –≤ —Ñ–æ–Ω–µ
```

**GPU –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:**
```bash
watch -n 1 nvidia-smi
```

**Checkpoint:**
```bash
ls -lh data/processed/query_variants_checkpoint.parquet
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–º–ø–æ—Ä—Ç–æ–≤:**
```bash
python -c "import torch; print(torch.cuda.is_available())"
python -c "import transformers, bitsandbytes, accelerate"
```

---

## üéØ –ò—Ç–æ–≥–æ

**3 –∫–æ–º–∞–Ω–¥—ã –¥–æ –ø—Ä–æ—Ä—ã–≤–∞:**

```bash
./install_dependencies.sh     # 5-10 –º–∏–Ω
./test_llm_generation.sh      # 2-3 –º–∏–Ω
./run_llm_generation.sh       # 2-3 —á–∞—Å–∞ (–Ω–∞ –Ω–æ—á—å)
```

**–£—Ç—Ä–æ–º:**
```bash
python scripts/03_run_search.py
# ‚Üí submit_alpha_rag_elite.csv
# ‚Üí Submit –Ω–∞ leaderboard
# ‚Üí Hit@5 = 0.37-0.41! üéØ
```

**–ü–æ–≥–Ω–∞–ª–∏ –∫ 0.40+!** üí™üöÄ
